UserParameter=one.collect[*],bash -o 'pipefail' -c 'HOME=/var/lib/zabbix/ one$1 list -x 2> /dev/null > /tmp/one$1.out.tmp && mv /tmp/one$1.out.tmp /tmp/one$1.out && echo 0 || echo 1'
UserParameter=one.host.stat[*],xmlstarlet sel -t -c '//HOST_POOL/HOST/ID/text()|//HOST_POOL/HOST/HOST_SHARE/'$(echo "$1" | tr /a-z/ /A-Z/) /tmp/onehost.out | sed -e 's/<[^/<]*>/\t/g' -e 's/<\/[^<]*>/\n/g' | awk '{ if( "$2" == "avg" || "$2" == "sum" || "$2" == "" ) {sum+=$ 2} else {if($ 1 == "$2") {print $ 2}}} END { if( "$2" == "avg" ) { printf("%.0f", sum/NR) } if( "$2" == "" || "$2" == "sum") { printf("%.0f", sum) } }'
UserParameter=one.host.states[*],xmlstarlet sel -t -c '//HOST_POOL/HOST/ID/text()|//HOST_POOL/HOST/STATE' /tmp/onehost.out | sed -e 's/<[^/<]*>/\t/g' -e 's/<\/[^<]*>/\n/g' | awk '{init=0; monitoring_monitored=1; monitored=2; error=3; disabled=4; monitoring_error=5; monitoring_init=6; monitoring_disabled=7; offline=8}{ if( $ 2 == $1 ){print $ 1} }' | wc -l
UserParameter=one.vm.states[*],xmlstarlet sel -t -c '//VM_POOL/VM/ID/text()|//VM_POOL/VM/STATE|//VM_POOL/VM/LCM_STATE' /tmp/onevm.out | sed -e 's/<\/LCM_STATE>/\n/g' -e 's/\(<[^<]*>\)\{1,\}/\t/g' -e 's/\t\t//' | awk '{init=0; pending=1; hold=2; active=3; stopped=4; suspended=5; poweroff=8; undeployed=9; clonning=10; split("16 19 60", lcm_unknown); split("36 37 38 39 40 41 42 44 46 47 48 49 50 61", lcm_failed) }{ if("$1" == "unknown"){ for (i=1;i in lcm_unknown;i++) if($ 3 == lcm_unknown[i]){print $ 1}}} { if("$1" == "failed"){ if($ 3 == 7 ||$ 3 == 11){print $ 1}}}  { if("$1" == "failed"){ for (i=1;i in lcm_failed;i++) if($ 3 == lcm_failed[i]){print $ 1}}}  { if( !("$1" == "failed") && !("$1" == "unknown") && $ 2 == $1 ){print $ 1} }' | wc -l
UserParameter=one.datastore.stat[*],xmlstarlet sel -t -c '//DATASTORE_POOL/DATASTORE/ID/text()|//DATASTORE_POOL/DATASTORE/'$(echo "$1" | tr /a-z/ /A-Z/) /tmp/onedatastore.out | sed -e 's/<[^/<]*>/\t/g' -e 's/<\/[^<]*>/\n/g' | awk '{ if( "$2" == "avg" || "$2" == "sum" || "$2" == "" ) {sum+=$ 2} else {if($ 1 == "$2") {print $ 2}}} END { if( "$2" == "avg" ) { printf("%.0f", sum/NR) } if( "$2" == "" || "$2" == "sum") { printf("%.0f", sum) } }'
UserParameter=one.vnet.stat[*],xmlstarlet sel -t -c '//VNET_POOL/VNET/ID/text()|//VNET_POOL/VNET/'$(echo "$1" | tr /a-z/ /A-Z/) /tmp/onevnet.out 2>/dev/null| sed -e 's/<[^/<]*>/\t/g' -e 's/<\/[^<]*>/\n/g' | awk '{ if( "$2" == "avg" || "$2" == "sum" || "$2" == "" ) {sum+=$ 2} else {if($ 1 == "$2") {print $ 2}}} END { if( "$2" == "avg" ) { printf("%.0f", sum/NR) } if( "$2" == "" || "$2" == "sum") { printf("%.0f", sum) } }'
UserParameter=one.pvnet.stat[*],xmlstarlet sel -t -c '//VNET_POOL/VNET[not(boolean(./PARENT_NETWORK_ID/text()[1]))]/ID/text()|//VNET_POOL/VNET[not(boolean(./PARENT_NETWORK_ID/text()[1]))]/'$(echo "$1" | tr /a-z/ /A-Z/) /tmp/onevnet.out 2>/dev/null| sed -e 's/<[^/<]*>/\t/g' -e 's/<\/[^<]*>/\n/g' | awk '{ if( "$2" == "avg" || "$2" == "sum" || "$2" == "" ) {sum+=$ 2} else {if($ 1 == "$2") {print $ 2}}} END { if( "$2" == "avg" ) { printf("%.0f", sum/NR) } if( "$2" == "" || "$2" == "sum") { printf("%.0f", sum) } }'
UserParameter=one.vnet_ar.used[*],xmlstarlet sel -t -c '//VNET_POOL/VNET[not(./PARENT_NETWORK_ID/text())]/ID|//VNET_POOL/VNET[not(./PARENT_NETWORK_ID/text())]/AR_POOL/AR/ALLOCATED' /tmp/onevnet.out | sed -e 's/<\/ALLOCATED>\(<ID>\)/\n\1/g' -e 's/\(<[^<]*>\)\{1,\}/\t/g' -e 's/\t\t//' | awk '{print $ 1 " " (NF-1)/2}' | awk '{ if( "$1" == "avg" || "$1" == "sum" || "$1" == "" ) {sum+=$ 2} else {if($ 1 == "$1") {print $ 2}}} END { if( "$1" == "avg" ) { printf("%.0f", sum/NR) } if( "$1" == "" || "$1" == "sum") { printf("%.0f", sum) } }'
UserParameter=one.vnet_ar.free[*],xmlstarlet sel -t -c '//VNET_POOL/VNET[not(./PARENT_NETWORK_ID/text())]/ID|//VNET_POOL/VNET[not(./PARENT_NETWORK_ID/text())]/AR_POOL/AR/SIZE' /tmp/onevnet.out | sed -e 's/<\/SIZE>\(<ID>\)/\n\1/g' -e 's/\(<[^<]*>\)\{1,\}/\t/g' -e 's/\t\t//' | awk '{for (i=2; i<=NF; i++) sum+=$i }{print $ 1 " " sum }' | awk '{ if( "$1" == "avg" || "$1" == "sum" || "$1" == "" ) {sum+=$ 2} else {if($ 1 == "$1") {print $ 2}}} END { if( "$1" == "avg" ) { printf("%.0f", sum/NR) } if( "$1" == "" || "$1" == "sum") { printf("%.0f", sum) } }'